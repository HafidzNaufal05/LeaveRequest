@{
    Layout = "DashboardLayout";
}
<aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="index3.html" class="brand-link">
        <img src="~/AssetAdminLTE/dist/img/logo MII.jpg" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light">Leave Request</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
        @*<div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img src="~/AssetAdminLTE/dist/img/3x4.jpg" class="img-circle elevation-2" alt="User Image">
                </div>
                <div class="info">
                    <a href="#" class="d-block">Hafidz Naufal</a>
                </div>
            </div>
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img src="~/AssetAdminLTE/dist/img/avatar2.png" class="img-circle elevation-2" alt="User Image">
                </div>
                <div class="info">
                    <a href="#" class="d-block">Khanza Rahmasila</a>
                </div>
            </div>*@

        <!-- SidebarSearch Form -->
        <div class="form-inline">
            <div class="input-group" data-widget="sidebar-search">
                <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
                <div class="input-group-append">
                    <button class="btn btn-sidebar">
                        <i class="fas fa-search fa-fw"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
            <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                <!-- Add icons to the links using the .nav-icon class
    with font-awesome or any other icon font library -->
                <li class="nav-item">
                    <a class="nav-link" asp-area="" asp-controller="Request" asp-action="Index">
                        <i class="nav-icon far fa-calendar-check"></i><span class="brand-text font-weight-light">Apply Leave Request</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" asp-area="" asp-controller="Request" asp-action="IndexHistory">
                        <i class="nav-icon fas fa-history"></i><span class="brand-text font-weight-light">History Request</span>
                    </a>
                </li>
            </ul>
        </nav>
        <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
</aside>
<div class="content-wrapper">
    <div class="container ">
        <h4 class="text-muted font-10 m-b-5 text-center">Welcome</h4>
        <p class="text-muted text-center">Leave Request Form Employee.</p>
        @*<a href="javascript:void(0)" class="btn bg-transparant text-success" data-toggle="modal" data-target="#Request">Add Request</a>*@
        <div style="width:90%; margin:0 auto;">
            <button type="button" class="btn btn-success" style="margin:10px auto" data-toggle="modal" data-target="#Request" onclick="ClearData()" data-bs-toggle="tooltip" data-bs-placement="top" title="Insert Data"><i class="fa fa-plus" aria-hidden="true"></i> Add Request</button>
            @*<div class="container-fluid mt-3">*@
            @*<table id="myTable" class="table table-striped table-bordered dataTable" style="width:100%">*@
            <table id="myTable" class="table table-bordered table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                <thead class="thead-light">
                    <tr role="row">
                        <th>No</th>
                        <th>NIK</th>
                        <th>Id</th>
                        <th>Leave Category</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Reason Request</th>
                        <th>NIK</th>
                        <th>Notes</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>


        <div class="modal fade" id="Request" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addModalLabel">Add Request</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="formrole">
                            <div class="row">
                                <div class="col-6">
                                    @*<div class="form-group">
                                            <label for="id" class="col-form-label">NIK:</label>
                                            <input type="text" class="form-control" id="nik" name="nik">
                                        </div>*@
                                    <div class="form-group">
                                        <label for="name" class="col-form-label">Start Date:</label>
                                        <input type="date" class="form-control" id="startdate" name="startdate">
                                    </div>
                                    <div class="form-group">
                                        <label for="name" class="col-form-label">Reason Request:</label>
                                        <select id="reasonrequest" class="form-control" name="reasonrequest">
                                            <option value="Normal Leave">Normal Leave</option>
                                            <option value="Married">Married</option>
                                            <option value="Marry Or Circumcise Or Baptize Children">Marry Or Circumcise Or Baptize Children</option>
                                            <option value="Wife Gave Birth Or Had A Miscarriage">Wife Gave Birth Or Had A Miscarriage</option>
                                            <option value="Husband Or Wife Parents Or In Laws Children Or Son In Law Have Passed Away">Husband Or Wife Parents Or In Laws Children Or Son In Law Have Passed Away</option>
                                            <option value="Family Member In One House Died">Family Member In One House Died</option>
                                            <option value="Maternity Leave">Maternity Leave</option>
                                            <option value="Accident Leave">Accident Leave</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-6">
                                    @*<div class="form-group">
                                            <label for="name" class="col-form-label">Leave Category:</label>
                                            <select id="leavecategory" class="form-control" name="leavecategory">
                                                <option value="Special Request">Special Request</option>
                                                <option value="Normal Request">Normal Request</option>
                                            </select>
                                        </div>*@
                                    <div class="form-group">
                                        <label for="name" class="col-form-label">End Date:</label>
                                        <input type="date" class="form-control" id="enddate" name="enddate">
                                    </div>
                                    <div class="form-group">
                                        <label for="name" class="col-form-label">Notes:</label>
                                        <textarea type="text" class="form-control" id="notes" name="notes"></textarea>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="SubmitRequest()">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts
{
    <script>
        var retrievedObject = localStorage.getItem('LoginRes');
        console.log('retrievedObject: ', JSON.parse(retrievedObject));
        currentLocation = window.location.pathname;
        console.log(currentLocation);

        if (retrievedObject != '"/Employee"') {
            window.location.replace('https://localhost:44350' + retrievedObject.replace(/^"(.*)"$/, '$1'))
        }
        var holiday = ["2021-01-01", "2021-02-12", "2021-03-11", "2021-03-14", "2021-04-02", "2021-05-01", "2021-05-12", "2021-05-13",
            "2021-05-14", "2021-05-26", "2021-06-01", "2021-07-20", "2021-08-10", "2021-08-17", "2021-10-19", "2021-12-24",
            "2021-12-25"];

        const startdatePicker = document.getElementById('startdate');
        startdatePicker.addEventListener('input', function (e) {
            console.log(this.value);
            var day = new Date(this.value).getUTCDay();
            console.log(day);
            if ([6, 0].includes(day)) {
                e.preventDefault();
                this.value = '';
                alert('Weekends not allowed');
            }
            else if (holiday.includes(this.value)) {
                e.preventDefault();
                this.value = '';
                alert('Holidays not allowed');
            }
        });

        function logout() {
            console.log('abc')
            localStorage.clear()
            window.location.replace('https://localhost:44350')
        }

        const enddatePicker = document.getElementById('enddate');
        enddatePicker.addEventListener('input', function (e) {
            var day = new Date(this.value).getUTCDay();
            if ([6, 0].includes(day)) {
                e.preventDefault();
                this.value = '';
                alert('Weekends not allowed');
            }
            else if (holiday.includes(this.value)) {
                e.preventDefault();
                this.value = '';
                alert('Holidays not allowed');
            }
        });

        debugger;
        $(document).ready(function () {

            $("#myTable").DataTable({
                "filter": true,
                "orderMulti": false,
                "ajax": {
                    "url": "https://localhost:44338/api/Request/GetRequestData",
                    "type": "get",
                    "datatype": "json",
                    "dataSrc": ""
                },
                "columnDefs": [
                    {
                        "targets": [2, 3, 7],
                        "visible": false,

                    },
                    {
                        "targets": [0, 2],
                        "searchable": true
                    },
                    {
                        "targets": [3],
                        "searchable": false,
                        "orderable": false
                    },
                ],
                "columns": [
                    {
                        "data": null,
                        "render": function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    {
                        "data": 'NIK'
                    },
                    {
                        "data": 'Id'
                    },
                    {
                        "data": 'LeaveCategory'
                    },
                    {
                        "data": 'StartDate',
                        render: function (data, type, row) {
                            let date = moment(row.StartDate).format('DD MMMM YYYY')
                            return date
                        }
                    },
                    {
                        "data": 'EndDate',
                        render: function (data, type, row) {
                            let date = moment(row.EndDate).format('DD MMMM YYYY')
                            return date
                        }
                    },
                    {
                        "data": 'ReasonRequest'
                    },
                    {
                        "data": 'EmployeeNIK'
                    },
                    {
                        "data": 'Notes'
                    },
                    {
                        "data": 'StatusRequest',
                    }
                ]
            });
        });

        function Get(id) {
            console.log(id);
            $.ajax({
                url: "/Request/Get",
                data: { id: id }
            }).done((result) => {
                console.log(result);
                var obj = JSON.parse(result);
                $("#Request").modal("show");
                $("#id").val(obj.data.Id);
                $("#leaveCategory").val(obj.data.LeaveCategory);
                $("#startdate").val(obj.data.StartDate);
                $("#enddate").val(obj.data.EndDate);
                $("#reasonrequest").val(obj.data.ReasonRequest);
                $("#employee").val(obj.data.Employee);
                $("#notes").val(obj.data.Notes);
                $("#statusRequest").val(obj.data.StatusRequest);
                //$("#ApprovedHRD").val(obj.data.approvedHRD);
                //$("#ApprovedManager").val(obj.data.approvedManager);
            }).fail((error) => {
                console.log(error);
            })
        }
        debugger;
        function SubmitRequest() {
            console.log("ok");
            var Request = new Object();
            /*Request.employeeNIK = $('#nik').val();*/
            /*Request.leaveCategory = $('#leavecategory').val();*/
            Request.startdate = $('#startdate').val();
            Request.enddate = $('#enddate').val();
            Request.reasonrequest = $('#reasonrequest').val();
            Request.notes = $('#notes').val();
            $.ajax({
                url: '/Request/SubmitRequest',
                type: "POST",
                data: Request
            }).done((result) => {
                if (result == 200) {
                    swal({
                        title: "Success!",
                        text: "Request Has Been Added, Cek Your Email",
                        icon: "success"
                    }
                    ).then(() => { location.reload() })
                    $('#Request').modal('hide');
                    /*$("#employeeNIK").val(null);*/
                    /*$("#leaveCategory").val(null);*/
                    $("#startDate").val(null);
                    $("#endDate").val(null);
                    $("#reasonRequest").val(null);
                    $("#notes").val(null);
                    //$("#statusRequest").val(null);
                    //$("#ApprovedHRD").val(null);
                    //$("#ApprovedManager").val(null);
                }
                else {
                    swal('Error', 'Something Went Wrong', 'error');
                }
            }).fail((error) => {
                console.log(error)
            });
        }
    </script>
}
