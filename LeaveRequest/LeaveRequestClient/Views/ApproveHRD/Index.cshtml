
<div class="p-3">
    <h4 class="text-muted font-18 m-b-5 text-center">Welcome</h4>
    <p class="text-muted text-center">Approval HRD Data Leave Request.</p>

    <div class="container-fluid mt-5">
        <table id="myTable" class="table table-striped table-bordered dataTable" style="width:100%">
            <thead class="thead-light">
                <tr role="row">
                    <th>No</th>
                    <th>NIK</th>
                    <th>Full Name</th>
                    <th>Id</th>
                    <th>Leave Category</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Reason Request</th>
                    <th>Notes</th>
                    <th>Email</th>
                    <th>Status Request</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tfoot>
            </tfoot>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="Request" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addModalLabel">Approve Request</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="formrole">
                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label for="id" class="col-form-label">Id:</label>
                                <input disabled type="text" class="form-control" id="id" name="id">
                            </div>
                            <div class="form-group">
                                <label for="name" class="col-form-label">Start Date:</label>
                                <input disabled type="text" class="form-control" id="startdate" name="startdate">
                            </div>
                            <div class="form-group">
                                <label for="name" class="col-form-label">Reason Request:</label>
                                <input disabled id="reasonrequest" class="form-control" name="reasonrequest">
                            </div>
                            <div class="form-group">
                                <label for="name" class="col-form-label">Notes Employee:</label>
                                <textarea disabled type="text" class="form-control" id="notes" name="notes"></textarea>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <label for="id" class="col-form-label">NIK:</label>
                                <input disabled type="text" class="form-control" id="nik" name="nik">
                            </div>
                            <div class="form-group">
                                <label for="name" class="col-form-label">End Date:</label>
                                <input disabled type="text" class="form-control" id="enddate" name="enddate">
                            </div>
                            <div class="form-group">
                                <label for="name" class="col-form-label">Email:</label>
                                <input disabled type="text" class="form-control" id="email" name="email">
                            </div>
                            <div class="form-group">
                                <label for="name" class="col-form-label">Notes:</label>
                                <textarea type="text" class="form-control" id="notes1" name="notes1"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="approve()">Approve</button>
                <button type="button" class="btn btn-primary" onclick="reject()">Reject</button>
            </div>
        </div>
    </div>
</div>
@section scripts
{
    <script>var table = null;
        $(document).ready(function () {
            table = $("#myTable").DataTable({
                "filter": true,
                "orderMulti": false,
                "ajax": {
                    "url": "https://localhost:44338/api/Request/GetApproveData",
                    "type": "get",
                    "datatype": "json",
                    "dataSrc": ""
                    /*"dataSrc": "data"*/
                },
                "columnDefs": [
                    {
                        "targets": [],
                        "visible": false,

                    },
                    {
                        "targets": [0, 2],
                        "searchable": true
                    },
                    {
                        "targets": [3],
                        "searchable": false,
                        "orderable": false
                    },
                ],
                "columns": [
                    {
                        "data": null,
                        "render": function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    {
                        "data": 'NIK'
                    },
                    {
                        "data": 'FullName'
                    },
                    {
                        "data": 'Id'
                    },
                    {
                        "data": 'LeaveCategory'
                    },
                    {
                        "data": 'StartDate',
                        render: function (data, type, row) {
                            let date = moment(row.StartDate).format('DD MMMM YYYY')
                            return date
                        }
                    },
                    {
                        "data": 'EndDate',
                        render: function (data, type, row) {
                            let date = moment(row.EndDate).format('DD MMMM YYYY')
                            return date
                        }
                    },
                    {
                        "data": 'ReasonRequest'
                    },
                    {
                        "data": 'Notes'
                    },
                    {
                        "data": 'Email'
                    },
                    {
                        "data": 'StatusRequest',
                        "render": function (StatusRequest) {
                            if (StatusRequest == "Approved by Manager") {
                                return "Approved By Manager";
                            }
                            else if (StatusRequest == "Approved by HRD") {
                                return "Approved";
                            }
                            else if (StatusRequest == "Reject by Manager") {
                                return "Reject By Manager";
                            }
                            else if (StatusRequest == "Reject by HRD") {
                                return "Reject By HRD";
                            }
                            else {
                                return "Waiting";
                            }
                        }
                    },
                    {
                        "data": null,
                        "render": function (data, type, row, meta) {
                            return '<button id="buttonUpdate" type="button" class="btn btn-primary">Approval</button>'
                        }
                    }
                ]
            });
        });

        function approve() {
            var id = $('#Id').val();
            console.log("put accessed");
            Approve(id);
        }

        function reject() {
            var id = $('#Id').val();
            console.log("put accessed");
            Reject(id);
        }

        $("#myTable").on('click', '#buttonUpdate', function () {
            var data = $("#myTable").DataTable().row($(this).parents('tr')).data();
            console.log(data);
            $("#Request").modal("show");
            $("#fullname").val(data.FullName);
            $("#nik").val(data.NIK);
            $("#leavecategory").val(data.LeaveCategory);
            $("#startdate").val(data.StartDate);
            $("#enddate").val(data.EndDate);
            $("#reasonrequest").val(data.ReasonRequest);
            $("#email").val(data.Email);
            $("#notes").val(data.Notes);
            $("#statusRequest").val(data.StatusRequest);
            $("#id").val(data.Id);
        });


        //function Get(Id) {
        //    console.log(Id);
        //    $.ajax({
        //        url: "/Approve/Get",
        //        data: { Id: Id }
        //    }).done((result) => {
        //        console.log(result);
        //        var obj = JSON.parse(result);
        //        $("#Request").modal("show");
        //        $("#fullname").val(obj.data.fullName);
        //        $("#nik").val(obj.data.nik);
        //        $("#leavecategory").val(obj.data.leaveCategory);
        //        $("#startdate").val(obj.data.startDate);
        //        $("#enddate").val(obj.data.endDate);
        //        $("#reasonrequest").val(obj.data.reasonRequest);
        //        $("#notes").val(obj.data.notes);
        //        $("#notes1").val();
        //        $("#statusRequest").val(obj.data.statusRequest);
        //        $("#id").val(obj.data.id);
        //    }).fail((error) => {
        //        console.log(error);
        //    })
        //}

        function Approve(Id) {
            var approve = new Object();
            approve.id = $('#id').val();
            approve.Email = $('#email').val();
            approve.notes = $('#notes1').val();
            $.ajax({
                type: "POST",
                url: '/ApproveHRD/Approve',
                data: approve
            }).done((result) => {
                console.log("ok");
                if (result == 200) {
                    swal('Success', 'Update Successfully', 'success');
                    $('#Request').modal('hide');
                    $("#id").val(null);
                    $("#nik").val(null);
                    $("#leavecategory").val(null);
                    $("#startdate").val(null);
                    $("#enddate").val(null);
                    $("#reasonrequest").val(null);
                    $("#notes").val(null);
                    /*$("#statusrequest").val(null);*/
                    //$("#ApprovedHRD").val(null);
                    //$("#ApprovedManager").val(null);
                    table.ajax.reload();
                }
                else {
                    swal('Error', 'Something Went Wrong', 'error');
                }
            }).fail((error) => {
                console.log(error)
            });
        }

        function Reject(Id) {
            var reject = new Object();
            reject.id = $('#id').val();
            reject.Email = $('#email').val();
            reject.notes = $('#notes1').val();
            $.ajax({
                type: "PUT",
                url: '/ApproveHRD/Reject',
                data: reject
            }).done((result) => {

                if (result == 200) {
                    swal('Success', 'Update Successfully', 'success');
                    $('#Request').modal('hide');
                    $("#id").val(null);
                    $("#nik").val(null);
                    $("#leavecategory").val(null);
                    $("#startdate").val(null);
                    $("#enddate").val(null);
                    $("#reasonrequest").val(null);
                    $("#notes").val(null);
                    table.ajax.reload();
                }
                else {
                    swal('Error', 'Something Went Wrong', 'error');
                }
            }).fail((error) => {
                console.log(error)
            });
        }</script>
}
